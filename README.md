# Let's Habr

Let's Habr это неофициальный клиент ресурса Habr для чтения статей под ОС Аврора, написанный на языке Rust.
В его основе лежит UI фреймворк [slint](https://github.com/slint-ui/slint), а также [форк](https://github.com/lmaxyz/winit/tree/aurora) библиотеки *winit*, адаптированный под ОС Аврора.

> **Примечание**: Приложение имеет ряд ограничений и недоработок, и является демонстрацией возможности написания приложений под ОС Аврора с использованием только языка Rust и его фреймворков.

## Сборка проекта и деплой на эмулятор

### Сборка и запуск приложения для тестирования на хосте

- [Установите rust](https://www.rust-lang.org/tools/install) на свой дистрибутив
- В корне проекта выполните команду `cargo run`

### Сборка и деплой на эмулятор

Для сборки и деплоя приложения на эмулятор используется самописный скрипт [deploy.sh](/deploy.sh).

> **Примечание**: Сборка приложения под эмулятор осуществляется на хостовой машине, т.к. версия rust, используемая в сборочном движке Авроры, сильно отстает от актуальной версии, поэтому для сборки приложения необходимо установить rust.

Перед сборкой и деплоем на эмулятор необходимо соблюсти следующие условия:

- Установить Aurora SDK
- Указать переменные окружения в `.env` файле

  ```bash
  AURORA_SDK_PATH="$HOME/AuroraOS"
  # Запустите команду `sfdk tools list` чтобы получить список актуальных для вас таргетов
  BUILD_TARGET='AuroraOS-5.1.1.60-base-x86_64'
  # Запустите команду `sfdk device list`, чтобы получить список актуальных для вас эмуляторов
  DEPLOY_DEVICE='Aurora OS эмулятор 5.1.1.60-base'
  ```

- В файле [Cargo.toml](/Cargo.toml) раздела `[patch.crates-io]` раскомментировать строку для использования *winit*, адаптированного под Аврору.

После этого можно запускать скрипт.

### Сборка под ARM

Сборка осуществляется с помощью скрипта [build_for_arm_device.sh](/build_for_arm_device.sh).

Для сборки необходимо соблюсти следующие условия:

- Установить таргет *armv7-unknown-linux-gnueabihf* для rust командой `rustup target add armv7-unknown-linux-gnueabihf`
- Необходимо соблюсти условия, указанные в разделе [cборка и деплой на эмулятор](#сборка-и-деплой-на-эмулятор)
- Перед сборкой необходимо установить тулчейн и прописать путь до него в файле [.cargo/config.toml](/.cargo/config.toml). Для дистрибутива Arch Linux я устанавливал [этот](https://aur.archlinux.org/packages/armv7-eabihf-glibc-bleeding-edge-toolchain), возможно [такой вариант](https://aur.archlinux.org/packages/arm-linux-gnueabihf-gcc-stage1) тоже подойдет, но я не тестировал.

## License

Приложение распространяется по следующей [лицензии](./LICENSE) в соответствии с условиями использования фреймворка Slint.

## ToDo

- Допилить сборку под устройство
- Исправить утечку памяти при загрузке данных. (Возможно не утечка, а просто клиент кэширует ответы, но со временем приложение начинает сжирать много памяти)
- Исправить производительность (Возможно проблема только на эмуляторе)

## Заметки

- Skia рендерер по производительности лучше, но размер бинаря получается в 2,5 раза больше + у меня не получилось собрать под arm
- Собрать под arm получилось, но приложение не запускается на устройстве, нужно дебажить
